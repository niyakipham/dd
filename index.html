<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêi·ªÉm Danh L·ªõp CT2901</title>
    <style>
        body {
            background-color: #FFD54F;
            background-image: radial-gradient(circle, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 10px 10px;
            font-family: 'Arial', sans-serif;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: #FFFDE7;
            border-radius: 20px;
            padding: 20px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }

        .date-picker, .period-picker {
            margin-bottom: 20px;
        }

        input[type="date"], select {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        /* ‚ú® NEW: CSS cho ph·∫ßn t√¨m ki·∫øm ‚ú® */
        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            gap: 10px;
        }

        #search-input {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
            width: 70%;
        }

        #search-results {
            margin-bottom: 15px;
            max-height: 150px;
            overflow-y: auto;
            text-align: left;
        }

        .search-result-item {
            background-color: #FFF9C4;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-result-item:hover {
            background-color: #FFF176;
        }
        /* ‚ú® END NEW ‚ú® */

        .student-card {
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .student-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .student-msv {
            font-size: 16px;
            color: #666;
        }

        .checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            accent-color: #4CAF50;
        }

        label {
            font-size: 18px;
        }

        button {
            background-color: #FFEB3B;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 5px;
        }

        button:hover {
            background-color: #FDD835;
        }

        .summary {
            display: none;
            text-align: left;
        }

        .summary h2 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            background-color: #FFE082;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 5px;
        }
        /* Ph·∫ßn l·ªãch s·ª≠ */
        .history-section {
            margin-top: 30px;
            text-align: left;
        }

        .history-days {
            margin-top: 20px;
        }

        .history-detail {
            display: none;
            margin-top: 20px;
        }

        .emoji {
            font-size: 30px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ƒêi·ªÉm Danh L·ªõp CT2901 <span class="emoji">üìã</span></h1>

        <div id="start-section">
            <div class="date-picker">
                <label for="attendance-date">Ch·ªçn ng√†y ƒëi·ªÉm danh:</label><br>
                <input type="date" id="attendance-date">
            </div>
            <div class="period-picker">
                <label for="attendance-period">Ch·ªçn ti·∫øt h·ªçc:</label><br>
                <select id="attendance-period">
                    <option value="1">Ti·∫øt 1</option>
                    <option value="2">Ti·∫øt 2</option>
                    <option value="3">Ti·∫øt 3</option>
                    <option value="4">Ti·∫øt 4</option>
                    <option value="5">Ti·∫øt 5</option>
                </select>
            </div>
            <button id="start-btn">B·∫Øt ƒê·∫ßu ƒêi·ªÉm Danh</button>
        </div>

        <div id="attendance-form" style="display: none;">
             <div class="search-container">
                <input type="text" id="search-input" placeholder="T√¨m ki·∫øm t√™n ho·∫∑c MSV...">
            </div>
            <div id="search-results"></div>
            <div class="student-card">
                <div class="student-name" id="student-name"></div>
                <div class="student-msv" id="student-msv"></div>
            </div>
            <div class="checkbox">
                <input type="checkbox" id="present">
                <label for="present">C√≥ m·∫∑t</label>
            </div>
            <button id="prev-btn" style="display: none;">Quay L·∫°i</button>
            <button id="next-btn">Ti·∫øp Theo</button>
        </div>

        <div class="summary" id="summary" style="display: none;">
            <h2>K·∫øt Qu·∫£ ƒêi·ªÉm Danh <span class="emoji">‚úÖ</span></h2>
            <p>Ng√†y: <span id="summary-date"></span></p>
            <p>Ti·∫øt: <span id="summary-period"></span></p>
            <p>Sƒ© s·ªë l·ªõp: 44</p>
            <p>S·ªë v·∫Øng: <span id="absent-count"></span></p>
            <h3>Danh s√°ch v·∫Øng:</h3>
            <ul id="absent-list"></ul>
            <button id="back-to-start">Quay L·∫°i</button>
        </div>

        <div class="history-section">
            <h2>Xem L·ªãch S·ª≠ ƒêi·ªÉm Danh <span class="emoji">üóìÔ∏è</span></h2>
            <label for="month-year">Ch·ªçn th√°ng/nƒÉm:</label><br>
            <select id="month-year"></select>
            <button id="view-history">Xem</button>
            <div class="history-days" id="history-days"></div>
            <div class="history-detail" id="history-detail"></div>
        </div>
    </div>

<script>
    // Danh s√°ch sinh vi√™n l·ªõp CT2901
    const students = [
        { msv: '2512101028', name: 'Nguy·ªÖn Kim B√¨nh An' },
        { msv: '2512101077', name: 'Ph·∫°m Di·ªáp Anh' },
        { msv: '2512101075', name: 'L√™ Vi·ªát Anh' },
        { msv: '2512101101', name: 'Ng√¥ Xu√¢n B·∫£o' },
        { msv: '2512101091', name: 'Nguy·ªÖn ƒê·ª©c Chung' },
        { msv: '2512101086', name: 'Nguy·ªÖn Nh·∫≠t Duy' },
        { msv: '2512101020', name: 'Nguy·ªÖn T·∫•n D≈©ng' },
        { msv: '2512101099', name: 'B√πi VƒÉn D≈©ng' },
        { msv: '2512101047', name: 'Cao ƒê·∫Øc ƒê·∫°t' },
        { msv: '2512101008', name: 'Ph·∫°m Th√†nh ƒê·∫°t' },
        { msv: '2512101085', name: 'Nguy·ªÖn Ng·ªçc ƒê·ª©c' },
        { msv: '2512101113', name: 'Ho√†ng Th·ªã H√¢n' },
        { msv: '2512101022', name: 'Ph·∫°m VƒÉn H√¢n' },
        { msv: '2512101025', name: 'Nguy·ªÖn Ch√≠ Hi·∫øu' },
        { msv: '2512101007', name: 'H√† ƒê·ª©c Hi·∫øu' },
        { msv: '2512101081', name: 'Nguy·ªÖn Trung Hi·∫øu' },
        { msv: '2512751015', name: 'Ph·∫°m Ho√†ng Hi·ªáp' },
        { msv: '2512101087', name: 'Nguy·ªÖn Ti·∫øn Ho√†ng' },
        { msv: '2512101067', name: 'Ph·∫°m VƒÉn Ho√†ng' },
        { msv: '2512101062', name: 'Ng√¥ Ho√†ng Huy' },
        { msv: '2512101037', name: 'Ph·∫°m Qu·ªëc Huy' },
        { msv: '2512101018', name: 'Ph·∫°m Kh√°nh H∆∞ng' },
        { msv: '2512101060', name: 'Tr·∫ßn Duy Kh√°nh' },
        { msv: '2512101016', name: 'L√™ ƒê√¨nh Minh Kh√¥i' },
        { msv: '2512101042', name: 'Nguy·ªÖn Ho√†ng Long' },
        { msv: '2512101092', name: 'Tr·∫ßn Kh√°nh Ly' },
        { msv: '2512101069', name: 'L√™ Minh' },
        { msv: '2512101019', name: 'L√™ ƒê·ª©c Minh' },
        { msv: '2512101073', name: 'Nguy·ªÖn Ph√∫ Minh' },
        { msv: '2512101125', name: 'Nguy·ªÖn Th·ªã Ng·ªçc Minh' },
        { msv: '2512101095', name: 'Ph·∫°m Trung Nghƒ©a' },
        { msv: '2512101011', name: 'ƒê·ªó Kh√°nh Nguy√™n' },
        { msv: '2512101112', name: 'Ho√†ng Th·ªã Nhi√™n' },
        { msv: '2512101089', name: 'V≈© ƒê·ª©c Phong' },
        { msv: '2512101083', name: 'L√™ Th·∫ø Ho√†ng Phong' },
        { msv: '2512101110', name: 'Nguy·ªÖn Mai Ph∆∞∆°ng' },
        { msv: '2512101084', name: 'Nguy·ªÖn Anh Qu√¢n' },
        { msv: '2512101013', name: 'H√† C√¥ng Quy·ªÅn' },
        { msv: '2512101065', name: 'Ho√†ng Th√°i S∆°n' },
        { msv: '2512101055', name: 'Nguy·ªÖn C√¥ng Ti·∫øn' },
        { msv: '2512101004', name: 'Nguy·ªÖn VƒÉn Tr∆∞·ªùng' },
        { msv: '2512101005', name: 'T√¥ Anh Tu·∫•n' },
        { msv: '2512101049', name: 'ƒê·ªó Anh T√∫' },
        { msv: '2512101009', name: 'Nguy·ªÖn Quang Vinh' }
    ];

    let currentIndex = 0;
    let attendance = new Array(students.length).fill(false);
    let selectedDate = '';
    let selectedPeriod = '1';

    const startSection = document.getElementById('start-section');
    const dateInput = document.getElementById('attendance-date');
    const periodSelect = document.getElementById('attendance-period');
    const startBtn = document.getElementById('start-btn');
    const formEl = document.getElementById('attendance-form');
    const studentNameEl = document.getElementById('student-name');
    const studentMsvEl = document.getElementById('student-msv');
    const presentCheckbox = document.getElementById('present');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const summaryEl = document.getElementById('summary');
    const summaryDateEl = document.getElementById('summary-date');
    const summaryPeriodEl = document.getElementById('summary-period');
    const absentCountEl = document.getElementById('absent-count');
    const absentListEl = document.getElementById('absent-list');
    const backToStartBtn = document.getElementById('back-to-start');

    // Ph·∫ßn l·ªãch s·ª≠
    const monthYearSelect = document.getElementById('month-year');
    const viewHistoryBtn = document.getElementById('view-history');
    const historyDaysEl = document.getElementById('history-days');
    const historyDetailEl = document.getElementById('history-detail');

    // ‚ú® NEW: L·∫•y c√°c element c·ªßa ph·∫ßn t√¨m ki·∫øm ‚ú®
    const searchInput = document.getElementById('search-input');
    const searchResultsEl = document.getElementById('search-results');

    // T·∫£i d·ªØ li·ªáu t·ª´ LocalStorage
    function getAttendanceData() {
        const data = localStorage.getItem('attendanceData');
        return data ? JSON.parse(data) : {};
    }

    // L∆∞u d·ªØ li·ªáu v√†o LocalStorage
    function saveAttendanceData(data) {
        localStorage.setItem('attendanceData', JSON.stringify(data));
    }

    // C·∫≠p nh·∫≠t select th√°ng/nƒÉm
    function updateMonthYearSelect() {
        const data = getAttendanceData();
        const months = Object.keys(data).sort().reverse();
        monthYearSelect.innerHTML = '';
        months.forEach(month => {
            const option = document.createElement('option');
            option.value = month;
            option.textContent = month;
            monthYearSelect.appendChild(option);
        });
    }

    // Hi·ªÉn th·ªã danh s√°ch ng√†y trong th√°ng
    function showDaysInMonth(month) {
        historyDaysEl.innerHTML = '<h3>C√°c ng√†y c√≥ ƒëi·ªÉm danh:</h3>';
        const data = getAttendanceData();
        const days = Object.keys(data[month] || {}).sort((a,b) => a - b);
        if (days.length === 0) {
            historyDaysEl.innerHTML += '<p>Kh√¥ng c√≥ d·ªØ li·ªáu.</p>';
            return;
        }
        days.forEach(day => {
            const btn = document.createElement('button');
            btn.textContent = `Ng√†y ${day}`;
            btn.onclick = () => showHistoryDetail(month, day);
            historyDaysEl.appendChild(btn);
        });
    }

    // Hi·ªÉn th·ªã chi ti·∫øt ƒëi·ªÉm danh ng√†y
    function showHistoryDetail(month, day) {
        historyDetailEl.style.display = 'block';
        historyDetailEl.innerHTML = `<h3>K·∫øt Qu·∫£ Ng√†y ${day}/${month.replace('-', '/')}</h3>`;
        const data = getAttendanceData();
        const periods = Object.keys(data[month][day] || {});
        historyDetailEl.innerHTML += '<ul>';
        periods.forEach(period => {
            const att = data[month][day][period];
            const absentStudents = students.filter((_, i) => !att[i]);
            historyDetailEl.innerHTML += `<li><strong>Ti·∫øt ${period}:</strong> Sƒ© s·ªë: 44, S·ªë v·∫Øng: ${absentStudents.length}<br><h4>Danh s√°ch v·∫Øng:</h4><ul>`;
            absentStudents.forEach(student => {
                historyDetailEl.innerHTML += `<li>${student.name} (MSV: ${student.msv})</li>`;
            });
            historyDetailEl.innerHTML += '</ul></li>';
        });
        historyDetailEl.innerHTML += '</ul>';
    }

    function showStudent(index) {
        if (index < 0) return; // Kh√¥ng quay l·∫°i d∆∞·ªõi 0
        if (index >= students.length) {
            showSummary();
            saveAttendance();
            return;
        }
        studentNameEl.textContent = students[index].name;
        studentMsvEl.textContent = `MSV: ${students[index].msv}`;
        presentCheckbox.checked = attendance[index]; // T·∫£i tr·∫°ng th√°i ƒë√£ l∆∞u
        prevBtn.style.display = index > 0 ? 'inline-block' : 'none';
    }

    function showSummary() {
        formEl.style.display = 'none';
        summaryEl.style.display = 'block';
        summaryDateEl.textContent = selectedDate;
        summaryPeriodEl.textContent = `Ti·∫øt ${selectedPeriod}`;

        const absentStudents = students.filter((_, i) => !attendance[i]);
        absentCountEl.textContent = absentStudents.length;

        absentListEl.innerHTML = '';
        absentStudents.forEach(student => {
            const li = document.createElement('li');
            li.textContent = `${student.name} (MSV: ${student.msv})`;
            absentListEl.appendChild(li);
        });
    }

    function saveAttendance() {
        const data = getAttendanceData();
        const [year, month, day] = selectedDate.split('-');
        const monthKey = `${year}-${month}`;
        if (!data[monthKey]) data[monthKey] = {};
        if (!data[monthKey][parseInt(day)]) data[monthKey][parseInt(day)] = {};
        data[monthKey][parseInt(day)][selectedPeriod] = attendance;
        saveAttendanceData(data);
        updateMonthYearSelect();
    }
    
    // ‚ú® NEW: H√†m x·ª≠ l√Ω t√¨m ki·∫øm ‚ú®
    function handleSearch() {
        const query = searchInput.value.toLowerCase().trim();
        searchResultsEl.innerHTML = ''; // X√≥a k·∫øt qu·∫£ c≈©

        if (query === '') {
            return; // ·∫®n k·∫øt qu·∫£ n·∫øu √¥ t√¨m ki·∫øm tr·ªëng
        }

        const filteredStudents = students
            .map((student, index) => ({ ...student, originalIndex: index }))
            .filter(student =>
                student.name.toLowerCase().includes(query) ||
                student.msv.toLowerCase().includes(query)
            );

        if (filteredStudents.length > 0) {
            filteredStudents.forEach(student => {
                const item = document.createElement('div');
                item.className = 'search-result-item';
                item.textContent = `${student.name} - ${student.msv}`;
                item.onclick = () => {
                    // L∆∞u tr·∫°ng th√°i ƒëi·ªÉm danh c·ªßa sinh vi√™n hi·ªán t·∫°i tr∆∞·ªõc khi nh·∫£y
                    if (currentIndex < students.length) {
                       attendance[currentIndex] = presentCheckbox.checked;
                    }
                    // Nh·∫£y ƒë·∫øn sinh vi√™n ƒë∆∞·ª£c ch·ªçn
                    currentIndex = student.originalIndex;
                    showStudent(currentIndex);
                    // D·ªçn d·∫πp
                    searchResultsEl.innerHTML = '';
                    searchInput.value = '';
                };
                searchResultsEl.appendChild(item);
            });
        } else {
            searchResultsEl.innerHTML = '<p style="text-align: center; color: #666;">Kh√¥ng t√¨m th·∫•y sinh vi√™n.</p>';
        }
    }


    // S·ª± ki·ªán
    startBtn.addEventListener('click', () => {
        selectedDate = dateInput.value;
        selectedPeriod = periodSelect.value;
        if (!selectedDate) {
            alert('Vui l√≤ng ch·ªçn ng√†y!');
            return;
        }
        startSection.style.display = 'none';
        formEl.style.display = 'block';
        currentIndex = 0;
        attendance = new Array(students.length).fill(false);
        showStudent(0);
    });

    nextBtn.addEventListener('click', () => {
        attendance[currentIndex] = presentCheckbox.checked;
        currentIndex++;
        showStudent(currentIndex);
        searchResultsEl.innerHTML = ''; // ‚ú® NEW: X√≥a k·∫øt qu·∫£ t√¨m ki·∫øm khi b·∫•m next
        searchInput.value = '';     // ‚ú® NEW: X√≥a n·ªôi dung √¥ t√¨m ki·∫øm
    });

    prevBtn.addEventListener('click', () => {
        attendance[currentIndex] = presentCheckbox.checked; // L∆∞u tr·∫°ng th√°i hi·ªán t·∫°i tr∆∞·ªõc khi quay l·∫°i
        currentIndex--;
        showStudent(currentIndex);
        searchResultsEl.innerHTML = ''; // ‚ú® NEW: X√≥a k·∫øt qu·∫£ t√¨m ki·∫øm khi b·∫•m prev
        searchInput.value = '';     // ‚ú® NEW: X√≥a n·ªôi dung √¥ t√¨m ki·∫øm
    });

    backToStartBtn.addEventListener('click', () => {
        summaryEl.style.display = 'none';
        startSection.style.display = 'block';
    });

    viewHistoryBtn.addEventListener('click', () => {
        const month = monthYearSelect.value;
        if (month) {
            showDaysInMonth(month);
            historyDetailEl.style.display = 'none';
        }
    });

    // ‚ú® NEW: G·∫Øn s·ª± ki·ªán 'input' ƒë·ªÉ t√¨m ki·∫øm real-time ‚ú®
    searchInput.addEventListener('input', handleSearch);

    // Kh·ªüi t·∫°o
    const today = new Date().toISOString().split('T')[0];
    dateInput.value = today;
    updateMonthYearSelect();

</script>
</body>
</html>
